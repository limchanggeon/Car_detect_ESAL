# 🗄️ 데이터베이스 구현 가이드

## 컴퓨터 비전 기반 교통 데이터베이스 구축 및 활용

### 📋 프로젝트 개요

본 프로젝트는 **YOLOv8 기반 실시간 차량 탐지**와 **ESAL(Equivalent Single Axle Load) 분석**을 통해 교통 데이터를 체계적으로 수집, 저장, 분석하는 통합 시스템입니다.

### 🎯 핵심 기능

#### 1. 실시간 데이터 수집
- **YOLOv8 모델**을 통한 실시간 차량 탐지 및 분류
- 탐지 결과를 **자동으로 데이터베이스에 저장**
- 차종별 분류 (승용차, 트럭, 버스, 밴, 오토바이)
- 신뢰도, 위치, 시간 정보 포함

#### 2. ESAL 기반 도로 분석
- 차종별 **ESAL 값 자동 계산**
- **도로 포장 손상 수준 예측** (1-5단계)
- **유지보수 일정 자동 생성**
- 예방적 유지보수 vs 긴급 보수 구분

#### 3. 데이터베이스 아키텍처
- **SQLite 기반** 경량 데이터베이스
- **7개 핵심 테이블** 설계
- **인덱스 최적화**로 빠른 쿼리 성능
- **관계형 구조**로 데이터 무결성 보장

### 🏗️ 시스템 구조

```
📁 프로젝트 루트/
├── 📁 src/car_detect_esal/
│   ├── 📁 database/           # 데이터베이스 모듈
│   │   ├── schema.py         # 데이터베이스 스키마 정의
│   │   ├── manager.py        # 데이터베이스 관리자
│   │   └── __init__.py       # 패키지 초기화
│   ├── 📁 gui/               # GUI 모듈
│   │   ├── database_panel.py # 데이터베이스 통계 패널
│   │   ├── main_window.py    # 메인 윈도우 (DB 통합)
│   │   └── stream_worker.py  # 실시간 데이터 저장
│   └── 📁 core/              # 핵심 탐지 엔진
├── 📁 data/                  # 데이터베이스 파일
│   └── traffic_data.db       # SQLite 데이터베이스
└── generate_sample_data.py   # 샘플 데이터 생성기
```

### 🗃️ 데이터베이스 스키마

#### 핵심 테이블 구조

**1. vehicle_detections (차량 탐지 결과)**
```sql
- id: 고유 식별자
- timestamp: 탐지 시간
- camera_id: 카메라 ID
- vehicle_type: 차종 (car, truck, bus, van, motorbike)
- confidence: 탐지 신뢰도
- bbox_x, bbox_y, bbox_width, bbox_height: 바운딩 박스 좌표
- roi_id: ROI 영역 식별자
```

**2. esal_analysis (ESAL 분석 결과)**
```sql
- id: 고유 식별자
- camera_id: 카메라 ID
- analysis_period: 분석 주기 (hourly, daily, weekly, monthly)
- total_esal: 총 ESAL 값
- car_count, truck_count, bus_count: 차종별 집계
- pavement_damage_level: 포장 손상 수준 (1-5)
- maintenance_urgency: 유지보수 긴급도
```

**3. maintenance_schedule (유지보수 일정)**
```sql
- id: 고유 식별자
- camera_id: 카메라 ID
- maintenance_type: 유지보수 유형
- priority_level: 우선순위 (1-5)
- scheduled_date: 예정 일자
- triggering_esal_value: 트리거된 ESAL 값
```

#### ESAL 계산 기준값
```python
ESAL_VALUES = {
    'car': 1,           # 승용차
    'motorbike': 1,     # 오토바이
    'van': 150,         # 밴
    'bus': 10430,       # 버스
    'truck': 25160,     # 트럭
}
```

### 🚀 실행 가이드

#### 1. 샘플 데이터 생성
```bash
# 30일간의 시연용 데이터 생성
python generate_sample_data.py
```

#### 2. GUI 애플리케이션 실행
```bash
# 메인 애플리케이션 실행
python -m src.car_detect_esal.gui.main_window
```

#### 3. 데이터베이스 기능 활용
- **📊 통계 탭**: 실시간 데이터베이스 통계 확인
- **⚖️ ESAL 탭**: ESAL 분석 실행 및 결과 확인
- **🔄 새로고침**: 30초마다 자동 업데이트
- **📊 내보내기**: CSV 형태로 데이터 내보내기
- **🧹 정리**: 오래된 데이터 자동 정리

### 📊 발표 활용 포인트

#### 1. 실시간 데이터 흐름
```
🎥 CCTV 영상 → 🤖 YOLOv8 탐지 → 🗄️ 데이터베이스 저장 → 📊 분석 및 시각화
```

#### 2. 자동화된 의사결정
- **예방적 유지보수**: ESAL 500,000 이상
- **표면 처리**: ESAL 700,000 이상  
- **중간 보수**: ESAL 850,000 이상
- **전면 재건설**: ESAL 1,000,000 이상

#### 3. 데이터 기반 인사이트
- **시간대별 교통 패턴** 분석
- **차종별 도로 영향도** 계산
- **지역별 유지보수 우선순위** 결정
- **예산 계획 및 자원 배분** 최적화

### 💡 기술적 특징

#### 데이터베이스 최적화
- **배치 저장**: 50개씩 묶어서 저장하여 성능 향상
- **인덱스 활용**: timestamp, camera_id 등에 인덱스 적용
- **자동 정리**: 365일 이상 된 데이터 자동 삭제
- **트랜잭션 관리**: 데이터 무결성 보장

#### 확장성 고려
- **모듈화된 구조**: 각 기능별 독립적 개발 가능
- **API 연동 준비**: REST API 확장 가능
- **클라우드 연동**: AWS RDS, PostgreSQL 등으로 확장 가능
- **스케일링**: 멀티 카메라, 멀티 서버 지원

### 📈 실제 활용 사례

#### 도로 관리 기관
- **실시간 모니터링**: 교통량 급증 지역 식별
- **예산 계획**: 연간 유지보수 예산 산정
- **우선순위 결정**: 긴급 보수 구간 선정

#### 교통 연구 기관
- **패턴 분석**: 계절별, 요일별 교통 패턴
- **정책 수립**: 교통 정책 효과 분석
- **미래 예측**: 교통량 증가 추세 예측

### 🎯 차별화 포인트

#### 1. 실시간 통합 시스템
- 탐지부터 분석까지 **원스톱 솔루션**
- **실시간 처리**로 즉각적인 의사결정 지원

#### 2. ESAL 기반 과학적 분석
- **국제 표준** ESAL 방법론 적용
- **정량적 평가**로 객관적 판단 근거 제공

#### 3. 사용자 친화적 인터페이스
- **직관적인 GUI**로 쉬운 操작
- **실시간 시각화**로 즉각적인 피드백

#### 4. 확장 가능한 아키텍처
- **모듈화된 설계**로 기능 추가 용이
- **표준 DB 인터페이스**로 다양한 시스템 연동

### 🔮 향후 발전 방향

#### 단기 목표 (3-6개월)
- **웹 대시보드** 개발
- **모바일 앱** 연동
- **알림 시스템** 구축

#### 중기 목표 (6-12개월)
- **AI 예측 모델** 고도화
- **클라우드 배포** 및 스케일링
- **다국어 지원** 및 글로벌 확장

#### 장기 목표 (1-2년)
- **IoT 센서** 연동
- **드론 영상** 분석 지원
- **스마트 시티** 플랫폼 연동

---

## 🛠️ 개발자 정보

**개발**: 임창건  
**프로젝트**: 컴퓨터 비전 기반 교통 데이터베이스 구축  
**기술 스택**: Python, YOLOv8, SQLite, PyQt5, OpenCV  
**문의**: limchanggeon@example.com  

---

*본 시스템은 실제 도로 관리 및 교통 연구에 활용 가능한 실무형 솔루션입니다.*