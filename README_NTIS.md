# 🚨 NTIS 실시간 CCTV 연동 가이드

## 📋 개요
국가교통정보센터(NTIS) API를 사용하여 실시간 CCTV 영상에서 차량을 탐지할 수 있습니다.

## 🔑 발급받은 API 키
```
e94df8972e194e489d6abbd7e7bc3469
```

## 🚀 사용 방법

### 1. GUI에서 NTIS 연동
1. **프로그램 실행**
   ```bash
   source .venv/bin/activate
   python main.py
   ```

2. **NTIS 버튼 클릭**
   - 메인 화면에서 "🚨 NTIS CCTV" 버튼 클릭

3. **API 키 입력**
   - 발급받은 API 키가 자동으로 입력됨
   - 확인 후 OK 클릭

### 2. 실시간 CCTV 선택 모드

#### A. 실제 NTIS API 연결 성공 시
- **CCTV 목록 표시**: 실제 국가교통정보센터 CCTV 목록
- **검색 기능**: 이름으로 CCTV 검색 가능
- **상세 정보**: ID, 이름, 위치, 스트림 URL 표시
- **선택**: 원하는 CCTV 선택 후 "✅ 선택" 버튼

#### B. API 연결 실패 시 (시뮬레이션 모드)
- **자동 전환**: API 연결 실패 시 시뮬레이션 모드 제안
- **2가지 옵션**:
  1. **📹 샘플 CCTV**: 테스트용 샘플 목록
  2. **🔗 직접 입력**: 사용자 정의 스트림 URL

### 3. 지원하는 스트림 형식
- **RTSP**: `rtsp://server/stream`
- **HTTP Live Streaming**: `http://server/stream.m3u8`
- **HTTP MP4**: `http://server/video.mp4`
- **로컬 파일**: `./demo_videos/video.mp4`

## 📊 성능 최적화

### 실시간 CCTV용 권장 설정
1. **성능 최적화 패널**에서 프리셋 선택:
   - **초고속**: 320px, 0.8 신뢰도 → 15+ FPS
   - **고속**: 416px, 0.7 신뢰도 → 8-15 FPS ⭐ **추천**
   - **균형**: 640px, 0.5 신뢰도 → 3-8 FPS
   - **고품질**: 640px, 0.3 신뢰도 → 1-5 FPS

2. **✅ 설정 적용** 버튼 클릭

## 🛠️ 문제 해결

### NTIS API 연결 오류
```
❌ 모든 NTIS 엔드포인트 연결 실패
```

**해결 방법**:
1. **인터넷 연결 확인**
2. **API 키 유효성 확인** (만료되었을 수 있음)
3. **시뮬레이션 모드 사용**: 
   - "Yes" 선택하여 테스트용 CCTV 사용
4. **방화벽 설정 확인**: HTTP/HTTPS 트래픽 허용

### 스트림 재생 오류
```
❌ 소스 열기 실패
```

**해결 방법**:
1. **URL 유효성 확인**: 스트림이 실제로 작동하는지 확인
2. **네트워크 연결**: RTSP/HTTP 포트 접근 가능한지 확인
3. **다른 CCTV 선택**: 다른 스트림 URL 시도
4. **로컬 테스트**: 먼저 데모 비디오로 테스트

### 탐지 성능 저하
```
⚠️ FPS가 매우 낮습니다
```

**해결 방법**:
1. **초고속 모드**: 성능 프리셋을 "초고속"으로 변경
2. **해상도 축소**: 320x320 또는 416x416 사용
3. **신뢰도 증가**: 0.8 이상으로 설정하여 불필요한 탐지 줄임
4. **GPU 활용**: CUDA 설치 시 GPU 사용

## 📝 사용 예시

### 1. 실제 NTIS CCTV 사용
```
1. NTIS 버튼 클릭
2. API 키 확인 (자동 입력됨)
3. CCTV 목록에서 "강남역 사거리" 선택
4. 스트림 추가 확인
5. ▶️ 시작 버튼으로 실시간 탐지 시작
```

### 2. 시뮬레이션 모드 사용
```
1. NTIS 버튼 → API 연결 실패
2. "시뮬레이션 모드로 전환?" → Yes
3. 샘플 탭에서 "테스트용 로컬 비디오" 선택
4. 스트림 추가 확인  
5. ▶️ 시작 버튼으로 탐지 시작
```

### 3. 직접 URL 입력
```
1. NTIS 버튼 → 시뮬레이션 모드
2. "🔗 직접 입력" 탭 선택
3. 이름: "내 CCTV"
4. URL: "rtsp://192.168.1.100/stream"
5. ✅ 선택 → 스트림 추가
```

## 🎯 팁 & 주의사항

### ✅ 좋은 예시
- **안정한 네트워크**: 유선 연결 권장
- **적절한 성능 설정**: 하드웨어에 맞는 프리셋 선택
- **테스트 먼저**: 데모 비디오로 정상 작동 확인 후 실시간 CCTV 사용

### ⚠️ 주의사항
- **API 사용량**: NTIS API 일일 한도 확인
- **스트림 안정성**: 일부 CCTV는 간헐적으로 연결 끊어질 수 있음
- **저작권**: 공개된 CCTV만 사용, 사생활 침해 주의
- **성능**: 너무 많은 CCTV 동시 연결 시 성능 저하

## 📞 지원

문제 발생 시:
1. **로그 확인**: 터미널 출력 메시지 확인
2. **단계별 테스트**: 데모 비디오 → 시뮬레이션 → 실제 NTIS 순서로 테스트
3. **설정 초기화**: 성능 설정을 "고속"으로 리셋 후 재시도

---

**🎉 이제 실시간 CCTV에서 차량 탐지를 시작하세요!**